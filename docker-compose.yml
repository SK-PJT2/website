version: '3.8'

services:
  web:
    image: nginx:latest
    container_name: safepoint_web
    ports:
      - "80:80"
    volumes:
      - ./web/nginx.conf:/etc/nginx/conf.d/default.conf
      - ./static:/app/static
      - ./media:/app/media
    networks:
      - safepoint_net
    depends_on:
      - was

  was:
    build: .
    container_name: safepoint_was
    env_file:
      - .env
    volumes:
      - .:/app
    networks:
      - safepoint_net
    depends_on:
      - db

  db:
    image: mariadb:10.6
    container_name: safepoint_db
    environment:
      MARIADB_DATABASE: ${DB_NAME}
      MARIADB_USER: ${DB_USER}
      MARIADB_PASSWORD: ${DB_PASSWORD}
      MARIADB_ROOT_PASSWORD: ${DB_PASSWORD}
      TZ: Asia/Seoul
    volumes:
      - db_data:/var/lib/mysql
    networks:
      - safepoint_net

  redis:
    image: redis:7-alpine
    container_name: safepoint_redis
    networks:
      - safepoint_net

networks:
  safepoint_net:
    driver: bridge

volumes:
  db_data: