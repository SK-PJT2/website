{% extends 'base.html' %}

{% block content %}
    <h1>중고거래 마켓</h1>

    <form method="get" style="margin-top: 10px; margin-bottom: 20px; display:flex; gap:10px; flex-wrap:wrap;">
        <input type="text" name="q" placeholder="검색어를 입력하세요" value="{{ current_query }}" />

        <select name="category">
            <option value="">전체 카테고리</option>
            {% for cat in categories %}
                <option value="{{ cat.slug }}" {% if cat.slug == current_category_slug %}selected{% endif %}>
                    {{ cat.name }}
                </option>
            {% endfor %}
        </select>

        <select name="order">
            <option value="latest" {% if current_order == 'latest' %}selected{% endif %}>최신순</option>
            <option value="price_asc" {% if current_order == 'price_asc' %}selected{% endif %}>가격 낮은순</option>
            <option value="price_desc" {% if current_order == 'price_desc' %}selected{% endif %}>가격 높은순</option>
        </select>

        <button type="submit">검색</button>

        {% if user.is_authenticated %}
            <a href="{% url 'product_create' %}" style="margin-left:auto;">상품 등록하기</a>
        {% endif %}
    </form>

    {% if products %}
        <ul style="list-style:none; padding:0; margin:0;">
            {% for product in products %}
                <li style="border:1px solid #dee2e6; border-radius:8px; padding:15px; margin-bottom:10px; background:#fff;">
                    <a href="{% url 'product_detail' product.pk %}" style="color:inherit; text-decoration:none;">
                        <h2 style="margin:0 0 5px 0;">{{ product.title }}</h2>
                        <p style="margin:0 0 5px 0; color:#868e96;">
                            {{ product.price }} P ·
                            {% if product.category %}{{ product.category.name }} · {% endif %}
                            {{ product.get_status_display }}
                        </p>
                        <p style="margin:0; color:#adb5bd; font-size:0.9rem;">
                            판매자: {{ product.seller.nickname|default:product.seller.username }}
                        </p>
                    </a>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>등록된 상품이 없습니다.</p>
    {% endif %}
{% endblock %}
