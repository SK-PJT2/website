{% extends 'base.html' %}

{% block content %}
    <h1>{{ product.title }}</h1>

    <p><strong>가격</strong>: {{ product.price }} P</p>
    <p><strong>상태</strong>: {{ product.get_status_display }}</p>
    <p><strong>카테고리</strong>:
        {% if product.category %}
            {{ product.category.name }}
        {% else %}
            (없음)
        {% endif %}
    </p>
    <p><strong>판매자</strong>: {{ product.seller.nickname|default:product.seller.username }}</p>

    {% if product.images.all %}
        <div style="display:flex; gap:10px; margin:15px 0; flex-wrap:wrap;">
            {% for img in product.images.all %}
                <img src="{{ img.image.url }}" alt="상품 이미지" style="width:150px; height:150px; object-fit:cover; border-radius:8px; border:1px solid #dee2e6;">
            {% endfor %}
        </div>
    {% endif %}

    <p>{{ product.description|linebreaks }}</p>

    {% if user.is_authenticated %}
        <form method="post" action="{% url 'wishlist_toggle' product.pk %}" style="margin-top:15px;">
            {% csrf_token %}
            {% if wished %}
                <button type="submit">관심 상품 해제</button>
            {% else %}
                <button type="submit">관심 상품 등록</button>
            {% endif %}
        </form>

        <div style="margin-top: 10px;">
            {% if user != product.seller %}
                {# 1. 구매자가 판매자에게 채팅을 거는 경우 #}
                <a href="{% url 'chat:get_or_create_room' product.pk %}">판매자와 채팅하기</a>
            {% else %}
                {# 2. 판매자 본인인 경우: 내게 온 채팅 목록으로 바로 이동 #}
                <a href="{% url 'chat:chat_list' %}">내게 온 채팅 확인하기</a>
            {% endif %}
        </div>
    {% else %}
        <p style="margin-top: 15px; color: #666;">
            <a href="{% url 'login' %}">로그인</a> 하시면 판매자와 실시간 채팅이 가능합니다.
        </p>
    {% endif %}

    <p style="margin-top:20px;">
        <a href="{% url 'market' %}">목록으로 돌아가기</a>
    </p>
{% endblock %}

